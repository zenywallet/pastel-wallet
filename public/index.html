<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="Pastel WALLET">
  <meta name="author" content="zenywallet">
  <meta name="keywords" content="wallet">
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="/semantic/semantic.min.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <script type="text/javascript" src="/js/supercop.js"></script>
  <script type="text/javascript" src="/js/supercop.wasm.js"></script>
  <script type="text/javascript" src="/js/cipher.js"></script>
  <script type="text/javascript" src="/js/coin.js"></script>
  <script type="text/javascript" src="/js/zopfli.raw.min.js"></script>
  <script type="text/javascript" src="/js/rawinflate.min.js"></script>
  <script type="text/javascript" src="/js/qcode-decoder.min.js"></script>
  <script type="text/javascript" src="/js/zepto.js"></script>
  <script type="text/javascript" src="/js/zepto_patch.js"></script>
  <script type="text/javascript" src="/semantic/semantic.js"></script>
  <script type="text/javascript" src="/js/jquery-qrcode.min.js"></script>
  <script type="text/javascript" src="/js/ui.js"></script>
  <script type="text/javascript" src="/js/pastel.js"></script>
  <title>Pastel WALLET</title>
</head>
<body>
<section id="section01" class="section">
  <div class ="intro">
    <div class="caption">Pastel Wallet</div>
    <div class="ui steps">
      <div class="step">
        <i class="qrcode icon"></i>
        <div class="content">
          <div class="title">Wallet Seed</div>
          <div class="description">Scan your seed card or use mnemonic</div>
        </div>
      </div>
      <div class="step">
        <i class="payment icon"></i>
        <div class="content">
          <div class="title">Access Key</div>
          <div class="description">Scan your key card or use password</div>
        </div>
      </div>
      <div class="step">
        <i class="child icon"></i>
        <div class="content">
          <div class="title">Wellcome</div>
          <div class="description">Your wallet is ready</div>
        </div>
      </div>
    </div>
  </div>
  <a href="#section02"><span></span>Start</a>
</section>
<section id="section02" class="section">
  <div class="ui container">
    <div class="ui center aligned basic segment">
      <div class="ui teal labeled icon button bt-scan-seed">
        Scan Seed Card
        <i class="qrcode icon"></i>
      </div>
    </div>
    <div class="ui enter aligned segment">
      <video id="qrvideo" autoplay></video>
    </div>
  </div>
  <a href="#section03"><span></span>Next</a>
</section>
<section id="section03" class="section">
  <div class="ui container">
    <div class="ui center aligned basic segment">
      <div id="qrcode"></div>
      <div id="seed"></div>
    </div>
  </div>
  <a href="#section01"><span></span>Top</a>
</section>
<script>
function showQrReader(cb) {
  var scandata = "";
  var cb_once = 0;
  var qr = new QCodeDecoder();
  var qr_stop = function() {
    setTimeout(function() {
      qr.stop();
    }, 1);
  }
  if(qr.isCanvasSupported() && qr.hasGetUserMedia()) {
    var video = document.querySelector('#qrvideo');
    function resultHandler(err, result) {
      if(err) {
        qr_stop();
        return;
      }
      if(cb_once) {
        return;
      }
      if(scandata == result) {
        cb_once = 1;
        qr_stop();
        cb(result);
      }
      scandata = result;
    }
    qr.decodeFromCamera(video, resultHandler);
  }
}

pastel.ready = function() {
  console.log('ready');
  $('.bt-scan-seed').click(function() {
    showQrReader(function(data) {
      console.log(data);
    });
  });

  var key = coin.ECPair.makeRandom();
  var priv = key.privateKey.toString('hex');
  var seedstr = 'seed:' + priv;
  document.getElementById('seed').innerHTML = seedstr;
  var s = 400;
  $('#qrcode').qrcode({
    render: 'canvas',
    ecLevel: 'Q',
    radius: 0.39,
    text: seedstr,
    size: s,
    mode: 2,
    label: 'seed',
    fontname: 'sans',
    fontcolor: '#393939'
  });
}
pastel.load();
</script>
</body>
</html>
